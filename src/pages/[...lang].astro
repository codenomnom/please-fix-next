---
import Layout from '../layouts/Layout.astro';
import type { MarkdownModule } from '../types/content';
import { getStats, formatNumber } from '../utils/gh-stats';

const statsData = await getStats();

export function getStaticPaths() {
  const pathToLang = (path: string) =>
    path.match(/\/data\/([^/]+)\//)?.[1] ?? 'en';

  const modules = import.meta.glob<MarkdownModule>('../data/**/*.{md,mdx}', {
    eager: true,
  });

  const langs = Object.keys(modules).map(pathToLang);

  return Object.entries(modules).map(([path, mod]) => {
    const lang = pathToLang(path);

    return {
      params: { lang: lang === 'en' ? undefined : lang }, // english is default, served at /
      props: {
        frontmatter: mod.frontmatter,
        Content: mod.default,
        lang,
        langs,
      },
    };
  });
}

const { frontmatter, Content, lang, langs } = Astro.props;
---

<Layout
  title={frontmatter.title}
  description={frontmatter.description}
  ogTitle={frontmatter.ogTitle}
  ogDescription={frontmatter.ogDescription}
  lang={lang}
  langs={langs}
>
  <Content
    stars={statsData ? formatNumber(statsData.stars) : 'â€¦'}
    stargazersUrl={`https://github.com/${import.meta.env.GITHUB_REPO}/stargazers`}
  />
</Layout>
