---
import Layout from '../layouts/Layout.astro';
import { getStats, formatNumber } from '../utils/gh-stats';
import { getAvailableLanguages, getAllContentFiles } from '../utils/i18n.utils';

const statsData = await getStats();

export function getStaticPaths() {
  const langs = getAvailableLanguages();
  const modules = getAllContentFiles();

  return modules.map(({ lang, mod }) => {
    return {
      params: { lang: lang === 'en' ? undefined : lang }, // english is default, served at /
      props: {
        frontmatter: mod.frontmatter,
        Content: mod.default,
        lang,
        langs,
      },
    };
  });
}

const { frontmatter, Content, lang, langs } = Astro.props;
---

<Layout
  title={frontmatter.title}
  description={frontmatter.description}
  ogTitle={frontmatter.ogTitle}
  ogDescription={frontmatter.ogDescription}
  lang={lang}
  langs={langs}
>
  <Content
    stars={statsData ? formatNumber(statsData.stars) : 'â€¦'}
    stargazersUrl={`https://github.com/${import.meta.env.GITHUB_REPO}/stargazers`}
  />
</Layout>
